{% extends "layout.njk" %}

{% block head %}
<link rel="stylesheet" href="/stylesheets/choices.min.css">
<script src="/javascripts/plywood/stats.js" type="module"></script>
{% endblock %}

{% block scripts %}
<script src="/javascripts/plywood/main.js" type="module"></script>
{% endblock %}

{% block content %}
<div class="stats-page">
    <div class="stats-header">
        <button onclick="window.location.href='/'" class="back-button">← Back to Calendar</button>
        <div class="header-controls-row" style="display: flex; flex-wrap: wrap; gap: 1.5em; align-items: center; margin-bottom: 8px;">
            <div class="date-controls">
                <input type="date" id="startDate" class="date-input">
                <span>to</span>
                <input type="date" id="endDate" class="date-input">
                <button id="refreshStats" class="refresh-button">Refresh</button>
            </div>
            <div style="display: flex; align-items: center; gap: 1em;">
                <label for="issueFilter"><b>Issues:</b></label>
                <select id="issueFilter" multiple style="min-width: 220px;"></select>
                <div class="filter-controls">
                    <label style="display: flex; align-items: center; gap:.5em;">
                        <input type="checkbox" id="groupByParent" style="vertical-align: middle;">
                        Group by parent
                    </label>
                    <label style="display: flex; align-items: center; gap:.5em;">
                        <input type="checkbox" id="showSubtasks" style="vertical-align: middle;">
                        Show sub-tasks
                    </label>
                    <label style="display: flex; align-items: center; gap:.5em;">
                        <input type="checkbox" id="globalWithComments" style="vertical-align: middle;">
                        Only show worklogs with comments
                    </label>
                    <label style="display: flex; align-items: center; gap:.5em;">
                        <input type="checkbox" id="globalHeatmap" style="vertical-align: middle;" checked>
                        Color worklogs based on duration
                    </label>
                </div>
            </div>
        </div>
    </div>
    
    <div class="stats-container">
        <!-- Charts Section -->
        <div class="stats-section charts-section">
            <h2>Worklog Analysis</h2>
            <div class="chart-container">
                <canvas id="analysisChart"></canvas>
            </div>
            <div class="chart-controls">
                <div class="chart-selector">
                    <button class="type-button active" data-type="issueTypes">
                        <span>📊 By Issue Type</span>
                    </button>
                    <button class="type-button" data-type="issues">
                        <span>🎫 By Issue</span>
                    </button>
                    <button class="type-button" data-type="projects">
                        <span>📁 By Project</span>
                    </button>
                </div>
                <button id="toggleChart" class="chart-toggle">🥧</button>
            </div>
        </div>
        
        <!-- Issue List Section -->
        <div class="stats-section">
            <h2>📋 Issue Details</h2>
            <div id="timeSpentList" class="stats-list"></div>
        </div>
    </div>
</div>
{% endblock %}